<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>IPTV Player - Pluto TV Style</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body, html { margin:0; padding:0; background:#000; color:#fff; font-family:sans-serif; height:100vh; }
    #senhaSection {
      height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:10px;
    }
    #senhaInput {
      padding:8px; font-size:16px; width:220px; border-radius:5px; border:none; text-align:center; background:#222; color:#fff;
    }
    #senhaBtn {
      padding:10px 20px; font-size:16px; cursor:pointer; background:#1c1c1c; border:1px solid #444; color:#fff; border-radius:5px;
    }
    small { color:#888; }
    .container {
      height:100vh; width:100vw; overflow:hidden; display:none; /* fica oculto at√© senha correta */
      display:flex;
    }
    .sidebar {
      background:#111; width:300px; padding:10px; box-sizing:border-box; display:flex; flex-direction:column;
    }
    .top-buttons {
      display:flex; gap:10px; margin-bottom:10px;
    }
    .top-buttons button {
      flex:1; padding:8px; font-size:14px; cursor:pointer; border-radius:4px; background:#222; border:1px solid #444; color:#fff;
    }
    .top-buttons button:hover {
      background:#333;
    }
    #vipMenu {
      display:none; flex-direction:column; gap:5px; margin-bottom:10px;
    }
    #vipMenu button {
      background:#222; border:1px solid #444; padding:6px; border-radius:3px; cursor:pointer; color:#fff;
    }
    #vipMenu button:hover { background:#333; }
    h2 {
      margin:0 0 10px 0;
    }
    .search-container {
      display:flex; align-items:center; background:#222; padding:5px; border-radius:5px; margin-bottom:10px;
    }
    .search-container input {
      flex:1; background:transparent; border:none; color:#fff; font-size:14px; padding:5px;
    }
    .search-container input::placeholder {
      color:#888;
    }
    #channelList {
      overflow-y:auto; flex:1;
    }
    .channel {
      display:flex; align-items:center; padding:8px; cursor:pointer; border-bottom:1px solid #222;
    }
    .channel:hover, .channel:focus {
      background:#222;
      outline:none;
    }
    .channel img {
      width:50px; height:50px; object-fit:contain; margin-right:10px;
    }
    .channel-name {
      flex:1; font-size:16px;
    }
    .favorite-btn {
      margin-left:auto; font-size:20px; background:none; border:none; cursor:pointer; color:gold;
    }
    .favorite-btn.not-fav {
      color:#555;
    }
    .main {
      flex:1; position:relative; display:flex; flex-direction:column;
    }
    #videoContainer {
      position:relative; background:black; width:100%; height:100vh; display:none;
    }
    #videoContainer.active {
      display:block;
    }
    video {
      width:100%; height:100vh; object-fit:contain; background:black;
    }
    .player-controls {
      position:absolute; top:10px; left:50%; transform:translateX(-50%);
      display:flex; gap:10px; z-index:10; background:rgba(0,0,0,0.5); padding:10px; border-radius:5px;
    }
    .player-controls button {
      padding:6px 12px; font-size:14px; background:#333; color:#fff; border:none; border-radius:4px; cursor:pointer;
    }
  </style>
</head>
<body>

<div id="senhaSection" role="dialog" aria-modal="true" aria-label="Tela de senha">
  <input id="senhaInput" type="password" placeholder="Digite a senha do cliente" autocomplete="off" aria-label="Campo de senha"/>
  <button id="senhaBtn" aria-label="Bot√£o entrar">Entrar</button>
  <small>Bem Vindo</small>
</div>

<div class="container" role="main" aria-hidden="true" aria-live="polite">
  <div class="sidebar" role="navigation" aria-label="Lista de canais e menus">
    <div class="top-buttons" id="topButtons" style="display:none;">
      <button id="usarBtn" aria-label="Lista Player">Lista Player</button>
      <button id="vipBtn" aria-label="Lista VIP">Lista Vip</button>
    </div>
    <div id="vipMenu" aria-label="Menu VIP"></div>

    <!-- Bot√µes de filtro -->
    <div id="filterContainer" style="display:none; gap:8px; margin-bottom:10px;">
      <button id="btnTodos" style="flex:1; padding:6px; font-size:14px; cursor:pointer; border-radius:4px; background:#222; color:#fff; border:1px solid #444;">Todos</button>
      <button id="btnFavoritos" style="flex:1; padding:6px; font-size:14px; cursor:pointer; border-radius:4px; background:#222; color:#fff; border:1px solid #444;">Favoritos</button>
    </div>

    <h2 id="channelsTitle" style="display:none;">Canais</h2>
    <div class="search-container" style="display:none;">
      üîç<input id="searchInput" type="text" placeholder="Pesquisar canal..." autocomplete="off" aria-label="Pesquisar canal"/>
    </div>
    <div id="channelList" tabindex="0" aria-label="Lista de canais"></div>
  </div>
  <div class="main">
    <div id="videoContainer" aria-live="polite">
      <video id="video" controls autoplay></video>
      <div class="player-controls">
        <button id="prevBtn" aria-label="Voltar canal">‚èÆÔ∏è Voltar</button>
        <button id="nextBtn" aria-label="Pr√≥ximo canal">‚è≠Ô∏è Pr√≥ximo</button>
        <button id="exitBtn" aria-label="Voltar ao menu">Menu üì∫</button>
      </div>
    </div>
  </div>
</div>

<script>
const validPwd = ['8888','9999'];
const listUrl = 'https://iptv.vivatele.com//get.php?username=viva_padrao&password=viva2384&type=m3u_plus&output=m3u8';

const vipUrls = {
  '0001': 'https://raw.githubusercontent.com/Isac-Arqueiro/vip01/refs/heads/main/canais',
  '0002': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal2.m3u',
  '0003': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal3.m3u',
  '0004': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal4.m3u',
  '0005': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal5.m3u',
  '0006': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal6.m3u',
  '0007': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal7.m3u',
  '0008': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal8.m3u',
  '0009': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal9.m3u',
  '0010': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal10.m3u'
};

let allChannels = [];
let currentIndex = 0;
let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

const senhaSection = document.getElementById('senhaSection');
const senhaInput = document.getElementById('senhaInput');
const senhaBtn = document.getElementById('senhaBtn');
const container = document.querySelector('.container');

const usarBtn = document.getElementById('usarBtn');
const vipBtn = document.getElementById('vipBtn');
const vipMenu = document.getElementById('vipMenu');

const btnTodos = document.getElementById('btnTodos');
const btnFavoritos = document.getElementById('btnFavoritos');
const searchInput = document.getElementById('searchInput');
const channelList = document.getElementById('channelList');

const videoContainer = document.getElementById('videoContainer');
const video = document.getElementById('video');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const exitBtn = document.getElementById('exitBtn');

const topButtons = document.getElementById('topButtons');
const filterContainer = document.getElementById('filterContainer');
const channelsTitle = document.getElementById('channelsTitle');
const searchContainer = document.querySelector('.search-container');

// Mostrar interface ap√≥s senha correta
function showInterface() {
  senhaSection.style.display = 'none';
  container.style.display = 'flex';
  container.setAttribute('aria-hidden', 'false');

  topButtons.style.display = 'flex';
  filterContainer.style.display = 'flex';
  channelsTitle.style.display = 'block';
  searchContainer.style.display = 'flex';

  // Carregar lista principal
  loadChannels(listUrl).then(channels => {
    allChannels = channels;
    renderChannelList(allChannels);
  });
}

function savePassword(pwd) {
  localStorage.setItem('iptv_password', pwd);
}

function getSavedPassword() {
  return localStorage.getItem('iptv_password');
}

function validatePassword(pwd) {
  return validPwd.includes(pwd);
}

// Tentar carregar interface se senha v√°lida j√° estiver salva
window.onload = () => {
  const saved = getSavedPassword();
  if (saved && validatePassword(saved)) {
    showInterface();
  } else {
    senhaInput.focus();
  }
};

senhaBtn.onclick = () => {
  const val = senhaInput.value.trim();
  if (validatePassword(val)) {
    savePassword(val);
    showInterface();
  } else {
    alert('Senha inv√°lida!');
    senhaInput.value = '';
    senhaInput.focus();
  }
};

senhaInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') senhaBtn.click();
});

btnTodos.onclick = () => renderChannelList(allChannels);
btnFavoritos.onclick = () => renderChannelList(allChannels.filter(c => favorites.includes(c.tvg_name)));

function saveFavorites() {
  localStorage.setItem('favorites', JSON.stringify(favorites));
}

function renderChannelList(channels) {
  channelList.innerHTML = '';
  if (channels.length === 0) {
    channelList.innerHTML = '<p>Nenhum canal encontrado.</p>';
    return;
  }
  channels.forEach((channel, index) => {
    const div = document.createElement('div');
    div.className = 'channel';
    div.tabIndex = 0;
    div.dataset.index = index;

    const img = document.createElement('img');
    img.src = channel.tvg_logo || 'https://via.placeholder.com/50?text=No+Logo';
    img.alt = channel.tvg_name;
    div.appendChild(img);

    const span = document.createElement('span');
    span.className = 'channel-name';
    span.textContent = channel.tvg_name;
    div.appendChild(span);

    const favBtn = document.createElement('button');
    favBtn.className = 'favorite-btn';
    favBtn.innerHTML = favorites.includes(channel.tvg_name) ? '‚òÖ' : '‚òÜ';
    if (!favorites.includes(channel.tvg_name)) favBtn.classList.add('not-fav');
    favBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleFavorite(channel.tvg_name, favBtn);
    });
    div.appendChild(favBtn);

    div.addEventListener('click', () => {
      playChannel(channel);
      currentIndex = index;
    });

    channelList.appendChild(div);
  });
}

function toggleFavorite(name, btn) {
  if (favorites.includes(name)) {
    favorites = favorites.filter(f => f !== name);
    btn.innerHTML = '‚òÜ';
    btn.classList.add('not-fav');
  } else {
    favorites.push(name);
    btn.innerHTML = '‚òÖ';
    btn.classList.remove('not-fav');
  }
  saveFavorites();
}

function playChannel(channel) {
  if (!channel || !channel.url) return;
  videoContainer.classList.add('active');
  container.setAttribute('aria-hidden', 'true');

  if (window.hls) {
    window.hls.destroy();
    window.hls = null;
  }
  if (Hls.isSupported()) {
    window.hls = new Hls();
    window.hls.loadSource(channel.url);
    window.hls.attachMedia(video);
  } else {
    video.src = channel.url;
  }
  video.play();
}

prevBtn.onclick = () => {
  currentIndex = (currentIndex - 1 + allChannels.length) % allChannels.length;
  playChannel(allChannels[currentIndex]);
};
nextBtn.onclick = () => {
  currentIndex = (currentIndex + 1) % allChannels.length;
  playChannel(allChannels[currentIndex]);
};
exitBtn.onclick = () => {
  video.pause();
  video.src = '';
  videoContainer.classList.remove('active');
  container.setAttribute('aria-hidden', 'false');
};

searchInput.addEventListener('input', () => {
  const q = searchInput.value.toLowerCase();
  renderChannelList(allChannels.filter(c => c.tvg_name.toLowerCase().includes(q)));
});

usarBtn.onclick = () => {
  loadChannels(listUrl).then(channels => {
    allChannels = channels;
    renderChannelList(allChannels);
    vipMenu.style.display = 'none';
  });
};

let vipVisible = false;
vipBtn.onclick = () => {
  vipVisible = !vipVisible;
  vipMenu.innerHTML = '';
  vipMenu.style.display = vipVisible ? 'flex' : 'none';
  if (vipVisible) {
    let idx = 1;
    for (const key of Object.keys(vipUrls)) {
      const b = document.createElement('button');
      b.textContent = `VIP ${idx}`;  // S√≥ mostra VIP 1, VIP 2, etc
      b.addEventListener('click', () => {
        const senha = prompt(`Digite a senha para acessar VIP ${idx}:`);
        if (senha === key) {
          loadChannels(vipUrls[key]).then(channels => {
            allChannels = channels;
            renderChannelList(allChannels);
          });
        } else {
          alert('Senha incorreta!');
        }
      });
      vipMenu.appendChild(b);
      idx++;
    }
  }
};

async function loadChannels(url) {
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error();
    const text = await res.text();
    return parseM3U(text);
  } catch (e) {
    alert('Erro ao carregar canais!');
    return [];
  }
}

function parseM3U(data) {
  const lines = data.split('\n');
  const channels = [];
  let channel = null;
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].trim();
    if (line.startsWith('#EXTINF:')) {
      const tvg_name = (line.match(/tvg-name="([^"]+)"/) || [null, 'Canal'])[1];
      const tvg_logo = (line.match(/tvg-logo="([^"]+)"/) || [null, ''])[1];
      const group_title = (line.match(/group-title="([^"]+)"/) || [null, ''])[1];
      channel = { tvg_name, tvg_logo, group_title, url: '' };
    } else if (line && channel) {
      channel.url = line;
      channels.push(channel);
      channel = null;
    }
  }
  return channels;
}
</script>

</body>
</html>
