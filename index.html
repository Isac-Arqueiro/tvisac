<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>IPTV Player - Pluto TV Style</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
  body, html { margin:0; padding:0; background:#000; color:#fff; font-family:sans-serif; height:100vh; }
  #senhaSection {
    height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:10px;
  }
  #senhaInput {
    padding:8px; font-size:16px; width:220px; border-radius:5px; border:none; text-align:center; background:#222; color:#fff;
  }
  #senhaBtn {
    padding:10px 20px; font-size:16px; cursor:pointer; background:#1c1c1c; border:1px solid #444; color:#fff; border-radius:5px;
  }
  small { color:#888; }

  .container {
    display:none; height:100vh; width:100vw; overflow:hidden; display:flex;
  }
  .sidebar {
    background:#111; width:300px; padding:10px; box-sizing:border-box; display:flex; flex-direction:column;
  }
  .top-buttons {
    display:flex; gap:10px; margin-bottom:10px;
  }
  .top-buttons button {
    flex:1; padding:8px; font-size:14px; cursor:pointer; border-radius:4px; background:#222; border:1px solid #444; color:#fff;
  }
  .top-buttons button:hover {
    background:#333;
  }
  #vipMenu {
    display:none; flex-direction:column; gap:5px; margin-bottom:10px;
  }
  #vipMenu button {
    background:#222; border:1px solid #444; padding:6px; border-radius:3px; cursor:pointer; color:#fff;
  }
  #vipMenu button:hover { background:#333; }
  h2 {
    margin:0 0 10px 0;
  }
  .filter-buttons {
    display:flex; gap:8px; margin-bottom:10px;
  }
  .filter-buttons button {
    flex:1;
    padding:6px;
    font-size:14px;
    cursor:pointer;
    border-radius:4px;
    background:#222;
    color:#fff;
    border:1px solid #444;
  }
  .filter-buttons button:hover {
    background:#333;
  }
  .search-container {
    display:flex; align-items:center; background:#222; padding:5px; border-radius:5px; margin-bottom:10px;
  }
  .search-container input {
    flex:1; background:transparent; border:none; color:#fff; font-size:14px; padding:5px;
  }
  .search-container input::placeholder {
    color:#888;
  }
  #channelList {
    overflow-y:auto; flex:1;
  }
  .channel {
    display:flex; align-items:center; padding:8px; cursor:pointer; border-bottom:1px solid #222;
  }
  .channel:hover, .channel:focus {
    background:#222;
    outline:none;
  }
  .channel img {
    width:50px; height:50px; object-fit:contain; margin-right:10px;
  }
  .channel-name {
    flex:1; font-size:16px;
  }
  .favorite-btn {
    margin-left:auto; font-size:20px; background:none; border:none; cursor:pointer; color:gold;
  }
  .favorite-btn.not-fav {
    color:#555;
  }
  .main {
    flex:1; position:relative; display:flex; flex-direction:column;
  }
  #videoContainer {
    position:relative; background:black; width:100%; height:100vh; display:none;
  }
  #videoContainer.active {
    display:block;
  }
  video {
    width:100%; height:100vh; object-fit:contain; background:black;
  }
  .player-controls {
    position:absolute; top:10px; left:50%; transform:translateX(-50%);
    display:flex; gap:10px; z-index:10; background:rgba(0,0,0,0.5); padding:10px; border-radius:5px;
  }
  .player-controls button {
    padding:6px 12px; font-size:14px; background:#333; color:#fff; border:none; border-radius:4px; cursor:pointer;
  }
</style>
</head>
<body>

<div id="senhaSection" role="dialog" aria-modal="true" aria-label="Tela de senha">
  <input id="senhaInput" type="password" placeholder="Digite a senha do cliente" autocomplete="off" aria-label="Campo de senha"/>
  <button id="senhaBtn" aria-label="Bot√£o entrar">Entrar</button>
  <small>Bem Vindo</small>
</div>

<div class="container" role="main" aria-hidden="true" style="display:none;">
  <div class="sidebar" role="navigation" aria-label="Lista de canais e menus">
    <div class="top-buttons">
      <button id="usarBtn" aria-label="Lista Player">Lista Player</button>
      <button id="vipBtn" aria-label="Lista VIP">Lista VIP</button>
    </div>
    <div id="vipMenu" aria-label="Menu VIP" style="display:none;"></div>

    <div class="filter-buttons" aria-label="Filtros de canais">
      <button id="filterTodos">Todos</button>
      <button id="filterFavoritos">Favoritos</button>
    </div>

    <h2>Canais</h2>
    <div class="search-container">
      üîç<input id="searchInput" type="text" placeholder="Pesquisar canal..." autocomplete="off" aria-label="Pesquisar canal"/>
    </div>
    <div id="channelList" tabindex="0" aria-label="Lista de canais"></div>
  </div>
  <div class="main">
    <div id="videoContainer" aria-live="polite">
      <video id="video" controls autoplay></video>
      <div class="player-controls">
        <button id="prevBtn" aria-label="Voltar canal">‚èÆÔ∏è Voltar</button>
        <button id="nextBtn" aria-label="Pr√≥ximo canal">‚è≠Ô∏è Pr√≥ximo</button>
        <button id="exitBtn" aria-label="Voltar ao menu">Menu üì∫</button>
      </div>
    </div>
  </div>
</div>

<script>
  console.clear();
  console.log("IPTV Player iniciado");

  // Senhas v√°lidas para o acesso inicial
  const validPwd = ['8888','9999'];
  const salvarPwd = '0000'; // senha VIP master para salvar (n√£o usada diretamente aqui)

  // URL da lista padr√£o
  const listUrl = 'https://iptv.vivatele.com//get.php?username=viva_padrao&password=viva2384&type=m3u_plus&output=m3u8'; 

  // URLs VIP com as senhas (chave √© senha VIP, valor √© URL)
  const vipUrls = {
    '0001': 'https://raw.githubusercontent.com/Isac-Arqueiro/vip01/refs/heads/main/canais',
    '0002': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal2.m3u',
    '0003': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal3.m3u',
    '0004': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal4.m3u',
    '0005': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal5.m3u',
    '0006': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal6.m3u',
    '0007': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal7.m3u',
    '0008': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal8.m3u',
    '0009': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal9.m3u',
    '0010': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal10.m3u',
  };

  let allChannels = [];
  let currentIndex = 0;
  let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

  const senhaSection = document.getElementById('senhaSection');
  const senhaInput = document.getElementById('senhaInput');
  const senhaBtn = document.getElementById('senhaBtn');
  const container = document.querySelector('.container');

  const usarBtn = document.getElementById('usarBtn');
  const vipBtn = document.getElementById('vipBtn');
  const vipMenu = document.getElementById('vipMenu');

  const filterTodos = document.getElementById('filterTodos');
  const filterFavoritos = document.getElementById('filterFavoritos');

  const searchInput = document.getElementById('searchInput');
  const channelList = document.getElementById('channelList');

  const videoContainer = document.getElementById('videoContainer');
  const video = document.getElementById('video');

  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const exitBtn = document.getElementById('exitBtn');

  // Mostrar a interface principal ap√≥s login correto
  function showMainInterface() {
    senhaSection.style.display = 'none';
    container.style.display = 'flex';
    container.setAttribute('aria-hidden', 'false');
    senhaInput.value = '';
  }

  // Salvar senha no localStorage
  function savePassword(pwd) {
    localStorage.setItem('iptv_password', pwd);
  }

  // Recuperar senha do localStorage
  function getSavedPassword() {
    return localStorage.getItem('iptv_password');
  }

  // Remover senha salva (se quiser implementar logout futuramente)
  function clearSavedPassword() {
    localStorage.removeItem('iptv_password');
  }

  // Fun√ß√£o para carregar canais
  async function loadChannels(url) {
    try {
      const res = await fetch(url);
      if(!res.ok) throw new Error('Falha ao carregar lista');
      const text = await res.text();
      return parseM3U(text);
    } catch(e) {
      console.error('Erro ao carregar canais:', e);
      alert('Erro ao carregar canais');
      return [];
    }
  }

  // Parse simples M3U para lista canais
  function parseM3U(data) {
    const lines = data.split('\n');
    const channels = [];
    let channel = null;
    for(let i=0; i<lines.length; i++) {
      let line = lines[i].trim();
      if(line.startsWith('#EXTINF:')) {
        const tvg_name = (line.match(/tvg-name="([^"]+)"/i) || [])[1] || '';
        const tvg_logo = (line.match(/tvg-logo="([^"]+)"/i) || [])[1] || '';
        const name = line.split(',').pop().trim();
        channel = {name, tvg_name, tvg_logo};
      } else if(line && !line.startsWith('#') && channel) {
        channel.url = line.trim();
        channels.push(channel);
        channel = null;
      }
    }
    return channels;
  }

  // Render lista de canais
  function renderChannels(list) {
    channelList.innerHTML = '';
    if(list.length === 0) {
      channelList.innerHTML = '<p>Nenhum canal encontrado.</p>';
      return;
    }
    list.forEach((ch, idx) => {
      const div = document.createElement('div');
      div.className = 'channel';
      div.tabIndex = 0;
      div.setAttribute('role', 'button');
      div.setAttribute('aria-label', `Canal ${ch.name}`);

      const img = document.createElement('img');
      img.src = ch.tvg_logo || 'https://cdn-icons-png.flaticon.com/512/727/727399.png';
      img.alt = ch.name + ' logo';
      div.appendChild(img);

      const span = document.createElement('span');
      span.className = 'channel-name';
      span.textContent = ch.name;
      div.appendChild(span);

      const favBtn = document.createElement('button');
      favBtn.className = 'favorite-btn ' + (favorites.includes(ch.name) ? '' : 'not-fav');
      favBtn.setAttribute('aria-label', favorites.includes(ch.name) ? 'Remover dos favoritos' : 'Adicionar aos favoritos');
      favBtn.textContent = favorites.includes(ch.name) ? '‚òÖ' : '‚òÜ';
      favBtn.onclick = (e) => {
        e.stopPropagation();
        toggleFavorite(ch.name, favBtn);
      };
      div.appendChild(favBtn);

      div.onclick = () => {
        currentIndex = idx;
        playChannel(list[currentIndex]);
      };
      div.onkeydown = (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          currentIndex = idx;
          playChannel(list[currentIndex]);
        }
      };

      channelList.appendChild(div);
    });
  }

  // Alternar favorito
  function toggleFavorite(channelName, btn) {
    const idx = favorites.indexOf(channelName);
    if(idx >= 0) {
      favorites.splice(idx,1);
      btn.classList.add('not-fav');
      btn.textContent = '‚òÜ';
      btn.setAttribute('aria-label', 'Adicionar aos favoritos');
    } else {
      favorites.push(channelName);
      btn.classList.remove('not-fav');
      btn.textContent = '‚òÖ';
      btn.setAttribute('aria-label', 'Remover dos favoritos');
    }
    localStorage.setItem('favorites', JSON.stringify(favorites));
  }

  // Filtrar canais por favoritos
  function filterFavorites() {
    const favChannels = allChannels.filter(ch => favorites.includes(ch.name));
    renderChannels(favChannels);
  }

  // Mostrar todos canais
  function showAllChannels() {
    renderChannels(allChannels);
  }

  // Fun√ß√£o de busca
  function filterSearch(term) {
    const lower = term.toLowerCase();
    const filtered = allChannels.filter(ch => ch.name.toLowerCase().includes(lower));
    renderChannels(filtered);
  }

  // Play canal
  function playChannel(ch) {
    if(!ch || !ch.url) return;
    videoContainer.classList.add('active');
    video.src = ch.url;
    video.play();
  }

  // Parar e esconder player
  function stopPlayer() {
    video.pause();
    video.src = '';
    videoContainer.classList.remove('active');
  }

  // Navegar canais anterior
  function prevChannel() {
    if(allChannels.length === 0) return;
    currentIndex = (currentIndex - 1 + allChannels.length) % allChannels.length;
    playChannel(allChannels[currentIndex]);
  }

  // Navegar canais pr√≥ximo
  function nextChannel() {
    if(allChannels.length === 0) return;
    currentIndex = (currentIndex + 1) % allChannels.length;
    playChannel(allChannels[currentIndex]);
  }

  // Gerar bot√µes VIP no menu
  function gerarVipButtons() {
    vipMenu.innerHTML = '';
    for(let i=1; i<=10; i++) {
      const numStr = i.toString().padStart(4,'0');
      const btn = document.createElement('button');
      btn.textContent = `VIP ${i}`;
      btn.setAttribute('data-vip', numStr);
      btn.addEventListener('click', () => {
        pedirSenhaVip(numStr);
      });
      vipMenu.appendChild(btn);
    }
  }

  // Solicitar senha VIP (com prompt oculto)
  function pedirSenhaVip(vipNumber) {
    const senhaVip = prompt(`Digite a senha para VIP ${parseInt(vipNumber,10)}:`, '');
    if(!senhaVip) return;
    if(senhaVip === vipNumber) {
      carregarVip(vipNumber);
    } else {
      alert('Senha VIP incorreta!');
    }
  }

  // Carregar lista VIP correspondente
  async function carregarVip(vipNumber) {
    const url = vipUrls[vipNumber];
    if(!url) {
      alert('Lista VIP n√£o encontrada');
      return;
    }
    allChannels = await loadChannels(url);
    if(allChannels.length === 0) {
      alert('Lista VIP vazia ou inv√°lida');
      return;
    }
    currentIndex = 0;
    showAllChannels();
  }

  // Eventos bot√µes principais
  usarBtn.addEventListener('click', async () => {
    allChannels = await loadChannels(listUrl);
    currentIndex = 0;
    showAllChannels();
  });

  vipBtn.addEventListener('click', () => {
    if(vipMenu.style.display === 'flex') {
      vipMenu.style.display = 'none';
    } else {
      gerarVipButtons();
      vipMenu.style.display = 'flex';
    }
  });

  filterTodos.addEventListener('click', () => {
    showAllChannels();
  });

  filterFavoritos.addEventListener('click', () => {
    filterFavorites();
  });

  searchInput.addEventListener('input', (e) => {
    filterSearch(e.target.value);
  });

  prevBtn.addEventListener('click', () => {
    prevChannel();
  });
  nextBtn.addEventListener('click', () => {
    nextChannel();
  });
  exitBtn.addEventListener('click', () => {
    stopPlayer();
  });

  // Valida√ß√£o da senha inicial
  senhaBtn.addEventListener('click', () => {
    const val = senhaInput.value.trim();
    if(validPwd.includes(val)) {
      savePassword(val);
      showMainInterface();
      // Carregar lista padr√£o ao entrar
      usarBtn.click();
    } else {
      alert('Senha incorreta!');
    }
  });

  // Entrar ao pressionar Enter no campo senha
  senhaInput.addEventListener('keydown', (e) => {
    if(e.key === 'Enter') {
      senhaBtn.click();
    }
  });

  // Ao carregar a p√°gina, verificar se j√° tem senha salva
  window.addEventListener('load', () => {
    const saved = getSavedPassword();
    if(saved && validPwd.includes(saved)) {
      showMainInterface();
      usarBtn.click();
    } else {
      senhaSection.style.display = 'flex';
      container.style.display = 'none';
    }
  });
</script>
</body>
</html>
