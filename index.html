
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>IPTV Player - Pluto TV Style</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
  body, html { margin:0; padding:0; background:#000; color:#fff; font-family:sans-serif; height:100vh; }
  #senhaSection {
    height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:10px;
  }
  #senhaInput {
    padding:8px; font-size:16px; width:220px; border-radius:5px; border:none; text-align:center; background:#222; color:#fff;
  }
  #senhaBtn {
    padding:10px 20px; font-size:16px; cursor:pointer; background:#1c1c1c; border:1px solid #444; color:#fff; border-radius:5px;
  }
  small { color:#888; }
  .container {
    display:none; height:100vh; width:100vw; overflow:hidden; display:flex;
  }
  .sidebar {
    background:#111; width:300px; padding:10px; box-sizing:border-box; display:flex; flex-direction:column;
  }
  .top-buttons {
    display:flex; gap:10px; margin-bottom:10px;
  }
  .top-buttons button {
    flex:1; padding:8px; font-size:14px; cursor:pointer; border-radius:4px; background:#222; border:1px solid #444; color:#fff;
  }
  .top-buttons button:hover {
    background:#333;
  }
  #vipMenu {
    display:none; flex-direction:column; gap:5px; margin-bottom:10px;
  }
  #vipMenu button {
    background:#222; border:1px solid #444; padding:6px; border-radius:3px; cursor:pointer; color:#fff;
  }
  #vipMenu button:hover { background:#333; }
  h2 {
    margin:0 0 10px 0;
  }
  .search-container {
    display:flex; align-items:center; background:#222; padding:5px; border-radius:5px; margin-bottom:10px;
  }
  .search-container input {
    flex:1; background:transparent; border:none; color:#fff; font-size:14px; padding:5px;
  }
  .search-container input::placeholder {
    color:#888;
  }
  #channelList {
    overflow-y:auto; flex:1;
  }
  .channel {
    display:flex; align-items:center; padding:8px; cursor:pointer; border-bottom:1px solid #222;
  }
  .channel:hover, .channel:focus {
    background:#222;
    outline:none;
  }
  .channel img {
    width:50px; height:50px; object-fit:contain; margin-right:10px;
  }
  .channel-name {
    flex:1; font-size:16px;
  }
  .favorite-btn {
    margin-left:auto; font-size:20px; background:none; border:none; cursor:pointer; color:gold;
  }
  .favorite-btn.not-fav {
    color:#555;
  }
  .main {
    flex:1; position:relative; display:flex; flex-direction:column;
  }
  #videoContainer {
    position:relative; background:black; width:100%; height:100vh; display:none;
  }
  #videoContainer.active {
    display:block;
  }
  video {
    width:100%; height:100vh; object-fit:contain; background:black;
  }
  .player-controls {
    position:absolute; top:10px; left:50%; transform:translateX(-50%);
    display:flex; gap:10px; z-index:10; background:rgba(0,0,0,0.5); padding:10px; border-radius:5px;
  }
  .player-controls button {
    padding:6px 12px; font-size:14px; background:#333; color:#fff; border:none; border-radius:4px; cursor:pointer;
  }
</style>
</head>
<body>

<div id="senhaSection" role="dialog" aria-modal="true" aria-label="Tela de senha">
  <input id="senhaInput" type="password" placeholder="Digite a senha do cliente" autocomplete="off" aria-label="Campo de senha"/>
  <button id="senhaBtn" aria-label="Bot√£o entrar">Entrar</button>
  <small>Bem Vindo</small>
</div>

<div class="container" role="main" aria-hidden="true">
  <div class="sidebar" role="navigation" aria-label="Lista de canais e menus">
    <div class="top-buttons">
      <button id="usarBtn" aria-label="Lista Player">Lista Player</button>
      <button id="vipBtn" aria-label="Lista VIP">Lista Vip</button>
    </div>
    <div id="vipMenu" aria-label="Menu VIP"></div>
    <h2>Canais</h2>
    <div class="search-container">
      üîç<input id="searchInput" type="text" placeholder="Pesquisar canal..." autocomplete="off" aria-label="Pesquisar canal"/>
    </div>
    <div id="channelList" tabindex="0" aria-label="Lista de canais"></div>
  </div>
  <div class="main">
    <div id="videoContainer" aria-live="polite">
      <video id="video" controls autoplay></video>
      <div class="player-controls">
        <button id="prevBtn" aria-label="Voltar canal">‚èÆÔ∏è Voltar</button>
        <button id="nextBtn" aria-label="Pr√≥ximo canal">‚è≠Ô∏è Pr√≥ximo</button>
        <button id="exitBtn" aria-label="Voltar ao menu">Menu üì∫</button>
      </div>
    </div>
  </div>
</div>

<script>
  console.clear();
  console.log("IPTV Player iniciado");

  const validPwd = ['8888','9999'];
  const salvarPwd = '0000'; // senha VIP master para salvar (n√£o usada diretamente aqui)

  const listUrl = 'https://iptv.vivatele.com//get.php?username=viva_padrao&password=viva2384&type=m3u_plus&output=m3u8'; // LINK TESTE FUNCIONAL - substitua pelo seu

  const vipUrls = {
    '0001': 'https://raw.githubusercontent.com/Isac-Arqueiro/vip01/refs/heads/main/canais',
    '0002': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal2.m3u',
    '0003': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal3.m3u',
    '0004': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal4.m3u',
    '0005': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal5.m3u',
    '0006': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal6.m3u',
    '0007': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal7.m3u',
    '0008': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal8.m3u',
    '0009': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal9.m3u',
    '0010': 'https://raw.githubusercontent.com/helenfernanda/gratis/main/iptvlegal10.m3u',
  };

  let allChannels = [];
  let currentIndex = 0;
  let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

  const senhaSection = document.getElementById('senhaSection');
  const senhaInput = document.getElementById('senhaInput');
  const senhaBtn = document.getElementById('senhaBtn');
  const container = document.querySelector('.container');

  const usarBtn = document.getElementById('usarBtn');
  const vipBtn = document.getElementById('vipBtn');
  const vipMenu = document.getElementById('vipMenu');

  const searchInput = document.getElementById('searchInput');
  const channelList = document.getElementById('channelList');

  const videoContainer = document.getElementById('videoContainer');
  const video = document.getElementById('video');

  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const exitBtn = document.getElementById('exitBtn');

  // Adicionar barra de filtros din√¢mica para categorias
  const categories = ['Todos', 'Favoritos'];
  const sidebar = document.querySelector('.sidebar');
  const filterContainer = document.createElement('div');
  filterContainer.style.display = 'flex';
  filterContainer.style.gap = '8px';
  filterContainer.style.marginBottom = '10px';

  // Fun√ß√£o para aplicar filtro por categoria
  function applyFilter(category) {
    if(category === 'Favoritos') {
      renderChannelList(allChannels.filter(c => favorites.includes(c.tvg_name)));
    } else {
      renderChannelList(allChannels);
    }
  }

  function createFilterButtons() {
    categories.forEach(cat => {
      const btn = document.createElement('button');
      btn.textContent = cat;
      btn.style.flex = '1';
      btn.style.padding = '6px';
      btn.style.fontSize = '14px';
      btn.style.cursor = 'pointer';
      btn.style.borderRadius = '4px';
      btn.style.background = '#222';
      btn.style.color = '#fff';
      btn.style.border = '1px solid #444';
      btn.addEventListener('click', () => {
        applyFilter(cat);
      });
      filterContainer.appendChild(btn);
    });
    sidebar.insertBefore(filterContainer, sidebar.firstChild);
  }

  createFilterButtons();

  // Fun√ß√£o para salvar favoritos
  function saveFavorites() {
    localStorage.setItem('favorites', JSON.stringify(favorites));
  }

  // Fun√ß√£o para carregar canais do arquivo M3U (simples)
  async function loadChannels(url) {
    try {
      const res = await fetch(url);
      if(!res.ok) throw new Error('Falha ao carregar lista');
      const text = await res.text();
      return parseM3U(text);
    } catch(e) {
      console.error('Erro ao carregar canais:', e);
      alert('Erro ao carregar canais');
      return [];
    }
  }

  // Fun√ß√£o simples para parsear M3U em objetos canal
  function parseM3U(data) {
    const lines = data.split('\n');
    const channels = [];
    let channel = null;
    for(let i=0; i<lines.length; i++) {
      let line = lines[i].trim();
      if(line.startsWith('#EXTINF:')) {
        // EX: #EXTINF:-1 tvg-id="..." tvg-name="Channel" tvg-logo="..." group-title="..."
        const tvg_name = (line.match(/tvg-name="([^"]+)"/) || [null, 'Canal'])[1];
        const tvg_logo = (line.match(/tvg-logo="([^"]+)"/) || [null, ''])[1];
        const group_title = (line.match(/group-title="([^"]+)"/) || [null, ''])[1];
        channel = {tvg_name, tvg_logo, group_title, url:''};
      } else if(line && channel) {
        channel.url = line;
        channels.push(channel);
        channel = null;
      }
    }
    console.log(`Canais carregados: ${channels.length}`);
    return channels;
  }

  // Renderizar lista de canais
  function renderChannelList(channels) {
    channelList.innerHTML = '';
    if(channels.length === 0) {
      channelList.innerHTML = '<p>Nenhum canal encontrado.</p>';
      return;
    }
    channels.forEach((channel, index) => {
      const div = document.createElement('div');
      div.className = 'channel';
      div.tabIndex = 0;
      div.setAttribute('role','button');
      div.setAttribute('aria-label', `Canal ${channel.tvg_name}`);
      div.dataset.index = index;

      const img = document.createElement('img');
      img.src = channel.tvg_logo || 'https://via.placeholder.com/50?text=No+Logo';
      img.alt = channel.tvg_name;
      div.appendChild(img);

      const span = document.createElement('span');
      span.className = 'channel-name';
      span.textContent = channel.tvg_name;
      div.appendChild(span);

      const favBtn = document.createElement('button');
      favBtn.className = 'favorite-btn';
      favBtn.innerHTML = favorites.includes(channel.tvg_name) ? '‚òÖ' : '‚òÜ';
      if(!favorites.includes(channel.tvg_name)) favBtn.classList.add('not-fav');
      favBtn.title = favorites.includes(channel.tvg_name) ? 'Remover dos favoritos' : 'Adicionar aos favoritos';
      favBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleFavorite(channel.tvg_name, favBtn);
      });
      div.appendChild(favBtn);

      div.addEventListener('click', () => {
        playChannel(channel);
        currentIndex = index;
      });

      div.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          playChannel(channel);
          currentIndex = index;
        }
      });

      channelList.appendChild(div);
    });
  }

  function toggleFavorite(name, btn) {
    if(favorites.includes(name)) {
      favorites = favorites.filter(f => f !== name);
      btn.innerHTML = '‚òÜ';
      btn.classList.add('not-fav');
      btn.title = 'Adicionar aos favoritos';
    } else {
      favorites.push(name);
      btn.innerHTML = '‚òÖ';
      btn.classList.remove('not-fav');
      btn.title = 'Remover dos favoritos';
    }
    saveFavorites();
  }

  // Tocar canal
  function playChannel(channel) {
    if(!channel || !channel.url) return;
    console.log('Tocando canal:', channel.tvg_name, channel.url);
    container.setAttribute('aria-hidden', 'true');
    videoContainer.classList.add('active');
    video.src = channel.url;

    // Tentativa de usar HLS.js se necess√°rio
    if(Hls.isSupported()) {
      if(window.hls) {
        window.hls.destroy();
      }
      window.hls = new Hls();
      window.hls.loadSource(channel.url);
      window.hls.attachMedia(video);
      window.hls.on(Hls.Events.ERROR, function(event, data) {
        console.error('Erro HLS:', data);
      });
    } else if(video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = channel.url;
    } else {
      alert('Seu navegador n√£o suporta reprodu√ß√£o deste formato.');
    }
    video.play();
  }

  // Navega√ß√£o canais
  function nextChannel() {
    currentIndex = (currentIndex + 1) % allChannels.length;
    playChannel(allChannels[currentIndex]);
  }
  function prevChannel() {
    currentIndex = (currentIndex - 1 + allChannels.length) % allChannels.length;
    playChannel(allChannels[currentIndex]);
  }

  // Voltar ao menu
  function exitPlayer() {
    video.pause();
    video.src = '';
    videoContainer.classList.remove('active');
    container.setAttribute('aria-hidden', 'false');
    senhaInput.focus();
  }

  // Filtrar canais pela busca
  function filterChannels() {
    const q = searchInput.value.toLowerCase();
    if(q === '') {
      renderChannelList(allChannels);
      return;
    }
    const filtered = allChannels.filter(c => c.tvg_name.toLowerCase().includes(q));
    renderChannelList(filtered);
  }

  // Eventos bot√£o senha
  senhaBtn.onclick = () => {
    const val = senhaInput.value.trim();
    console.log('Senha digitada:', val);
    if(validPwd.includes(val)) {
      // Senha correta
      senhaSection.style.display = 'none';
      container.style.display = 'flex';
      container.setAttribute('aria-hidden', 'false');
      loadChannels(listUrl).then(channels => {
        allChannels = channels;
        renderChannelList(allChannels);
      });
      senhaInput.value = '';
    } else {
      alert('Senha inv√°lida!');
    }
  };

  // Atalho enter na senha
  senhaInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') senhaBtn.click();
  });

  // Bot√µes top
  usarBtn.onclick = () => {
    console.log('Bot√£o Lista Player clicado');
    loadChannels(listUrl).then(channels => {
      allChannels = channels;
      renderChannelList(allChannels);
      vipMenu.style.display = 'none';
    });
  };

  vipBtn.onclick = () => {
    console.log('Bot√£o Lista VIP clicado');
    vipMenu.innerHTML = '';
    for(const [key, url] of Object.entries(vipUrls)) {
      const b = document.createElement('button');
      b.textContent = `VIP ${key}`;
      b.addEventListener('click', () => {
        loadChannels(url).then(channels => {
          allChannels = channels;
          renderChannelList(allChannels);
          vipMenu.style.display = 'flex';
        });
      });
      vipMenu.appendChild(b);
    }
    vipMenu.style.display = 'flex';
  };

  searchInput.addEventListener('input', filterChannels);

  prevBtn.onclick = prevChannel;
  nextBtn.onclick = nextChannel;
  exitBtn.onclick = exitPlayer;

  // Foco inicial na senha
  window.onload = () => {
    senhaInput.focus();
  };

</script>

</body>
</html>
